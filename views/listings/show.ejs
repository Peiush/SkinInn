<%- layout("layouts/boilerplate") %>
    <style>
        :root {
            --bg-off-white: #ffffff;
            --text-charcoal: #343a40;
            --brand-sage-green: #B2BBA2;
            --brand-warm-tan: #D8C3A5;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-off-white);
            color: var(--text-charcoal);
        }

        /* Custom Bootstrap Button Styles */
        .btn-warm-tan {
            background-color: #7e8dec;
            border-color: var(--brand-warm-tan);
            color: black;
            font-weight: 600;
        }
        .btn-warm-tan:hover {    
            opacity: 0.9;
            background-color: #caceea ;
            border-color: white;
            color: black;
        }
        
        .badge-sage-green {
            background-color: var(--brand-sage-green);
            color: white;
        }

        .border-sage-green {
            border-color: var(--brand-sage-green) !important;
        }
        
        .text-sage-green {
            color: var(--brand-sage-green);
        }

        .img-container {
            background-color: rgb(255, 255, 255);
            padding: 3rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 16px -1px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body>

    <div class="container ">
        <!-- Main Product Row -->
        <div class="row g-5">

            <!-- Left Column: Product Image -->
            <div class="col-md-6 d-flex align-items-center justify-content-center">
                <div class="img-container">
                    <img 
                        src="<%= listing.image.url %>" 
                        alt="<%= listing.name %>" 
                        class="img-fluid"
                        style="height: 600px; object-fit: contain;"
                        onerror="this.onerror=null;this.src='https://placehold.co/600x600/F8F7F4/343a40?text=Image+Not+Found';"
                    >
                </div>
            </div>

            <!-- Right Column: Product Details -->
            <div class="col-md-6 d-flex flex-column justify-content-center">
                
                <!-- Brand and Name -->
                <div>
                    <p class="text-muted text-uppercase small fw-medium"><%= listing.brand %> </p>
                    
                    <h1 class="h2 fw-bold"><%= listing.name %></h1>
                </div>

            
                <p class="text-secondary"><%= listing.description %></p>


                <!-- Variant Selection -->
                <div class="my-3">
                    <h3 class="small text-uppercase fw-semibold">Choose Variants</h3>
                    <button class="btn btn-outline-dark mt-2"><%= listing.volume %>ml</button>
                </div>

                <!-- Price -->
                <div class="d-flex align-items-baseline my-3">
                    <span class="h3 fw-bold me-3">₹<%= listing.price %></span>
                    <span class="text-muted text-decoration-line-through me-3">MRP ₹<%= Math.floor(listing.price * 1.15) %></span>
                    <span class="badge badge-sage-green fs-6">15% OFF</span>
                </div>
                <p class="text-muted small mt-n2">(incl. of all taxes)</p>

                <!-- Action Buttons: Add to Cart, Edit, Delete -->
                <div class="d-grid gap-2 d-sm-flex align-items-center mt-4 ">
                    <% if(currentUser) { %>
                    <form action="/cart/<%=currentUser._id%>/items " method="post">
                        <input type="hidden" name="listingId" value="<%= listing._id %>">
                        <input type="hidden" name="listingName" value="<%= listing.name %>">
                        <input type="hidden" name="listingPrice" value="<%= listing.price %>">
                    <button class="btn btn-warm-tan btn-lg flex-grow-1"><i class="fas fa-shopping-cart me-2"></i> Add to Cart</button>
                </form>
                    <% }  %>
                    <% if(currentUser && currentUser._id.equals(listing.owner._id)) { %>
                    <a href="/listings/<%= listing._id %>/edit" class="btn btn-outline-secondary">Edit</a>
                    <form method="POST" action="/listings/<%=listing._id%>?_method=DELETE">
                        <button class="btn btn-outline-danger">Delete</button>
                    </form>
                    <% } %>
                </div>

                <hr>
                <p class="d-flex">
                    <a class="btn btn-light " data-bs-toggle="collapse" href="#multiCollapseExample1" role="button" >What Makes It Potent?</a>
                  </p>
                  <div class="row">
                    <div class="col-toggle">
                      <div class="collapse multi-collapse" id="multiCollapseExample1">
                        <div class="cardddd cardd-body  ">
                            <h6><%=listing.whatMakesItPotent %></h6>
                        </div>
                      </div>
                    </div>
                    </div>

                    <hr>

                    <p class="d-flex mt-2">
                        <a class="btn btn-light " data-bs-toggle="collapse" href="#multiCollapseExample2" role="button" >Ideal For</a>
                      </p>
                      <div class="row">
                        <div class="col-toggle">
                          <div class="collapse multi-collapse" id="multiCollapseExample2">
                            <div class="cardddd cardd-body">
                              <h6><strong>Skin Type:</strong> <%=listing.skinType %></h6>
                              <h6><strong>Skin Concern:</strong> <%=listing.skinConcern %></h6>
                            </div>
                          </div>
                        </div>
                        </div>
            </div>
            <p class="text-uppercase small fw-small sold"> Sold by : <i><%= listing.owner.username %></i></p>
         <% if(currentUser) { %>
            <hr>
         <div class="review-form col-8  ">
            <div class="review-main mb-4">
                <h3>Leave a Review</h3>
            </div>
          

            <form action="/listings/<%= listing.id %>/reviews" method="post">

            <!-- <div class="mt-4 ">
                <label for="rating" class="form-label">Rating</label>
                <input type="range" class="form-range" min="1" max="5" step="0.5" id="rating" name="rating">
            </div> -->

            <label for="rating" class="form-label">Raiting : </label>
         <fieldset class="starability-heart">
         <input type="radio" id="no-rate" class="input-no-rate" name="rating" value="0" checked aria-label="No rating." />
         <input type="radio" id="first-rate1" name="rating" value="1" />
         <label for="first-rate1" title="Terrible">1 star</label>
         <input type="radio" id="first-rate2" name="rating" value="2" />
         <label for="first-rate2" title="Not good">2 stars</label>
          <input type="radio" id="first-rate3" name="rating" value="3" />
          <label for="first-rate3" title="Average">3 stars</label>
          <input type="radio" id="first-rate4" name="rating" value="4" />
          <label for="first-rate4" title="Very good">4 stars</label>
         <input type="radio" id="first-rate5" name="rating" value="5" />
         <label for="first-rate5" title="Amazing">5 stars</label>
        </fieldset>

            <div>
                <label for="comment">Comment</label>
                <textarea name="comment" id="comment" class="form-control mt-3" cols="30"></textarea>
            </div>

            <button class="btn btn-success mt-4">Add Review</button>


        </form>
         </div>
            <% }  %>

        <hr>
        <div class="row ms-5 mt-3">
            <h3 class="text-center mb-5">Reviews By Our Customers</h3>
            <% for(let review of listing.reviews) { %>
                <div class="card border review-box " style="width: 18rem; margin: 3rem;">
                    <div class="card-body-review p-1 text-center  ">
                      <div class="card-text-review">
                        <p class="mt-1 col-4 offset-4"><strong>@</strong> <%= review.author.username %> </p>
                        <!-- <strong>Rating:</strong> <%= review.rating  %>  <br> -->
                        <p class="starability-result offset-2" data-rating="<%= review.rating %>">
                        </p>
                        <strong>Comment:</strong> <%= review.comment %>

                    </div>
                        
                    <% if(currentUser && currentUser._id.equals(review.author._id)) { %>
                    <form action="/listings/<%= listing.id %>/reviews/<%= review.id %>?_method=DELETE"  method="post">
                        <button class="btn btn-dark mt-3">Delete</button>
                    </form>
                    <% } %>
                    
                     

                    </div>
                  </div>


                <% } %>
            
        </div>
        
        </div>
    </div>
</body>
</html>
